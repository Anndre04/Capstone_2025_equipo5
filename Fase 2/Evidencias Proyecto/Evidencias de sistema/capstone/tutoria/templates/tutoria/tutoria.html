{% extends "base.html" %}

{% block title %}Tutoría{% endblock %}

{% block content %}

{% if tutoria and tutoria.estado == "En curso" %}
<div class="container-fluid">

<!-- VIDEO - CHAT  -->
<div class="row g-3" id="videocallSection">
  <div class="col-12 col-xl-10">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-gradient-secondary text-white d-flex justify-content-between align-items-center py-3">
        <div>
          <h5 class="mb-0 fw-semibold">Tutoría: {{ tutoria.anuncio.titulo }}</h5>
          <p class="mb-0 small opacity-90">Tutor: {{ tutoria.tutor.usuario.nombre }} {{ tutoria.tutor.usuario.p_apellido }}</p>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-sm btn-light bg-white" id="btnToggleMic">
            <i class="bi bi-mic-fill"></i>
          </button>
          <button class="btn btn-sm btn-light bg-white" id="btnToggleCam">
            <i class="bi bi-camera-video-fill"></i>
          </button>
          <button class="btn btn-sm btn-danger bg-gradient" id="btnEndCall">
            <i class="bi bi-telephone-fill"></i>
          </button>
        </div>
      </div>
      <div class="card-body p-0 position-relative bg-dark">
        
        <!-- Video local -->
        <div class="position-absolute top-0 end-0 m-3 z-1" style="width: 220px; height: 165px;">
          <video id="localVideo" autoplay muted class="w-100 h-100 rounded-3 shadow-lg bg-dark"></video>
          <div class="position-absolute bottom-0 start-0 bg-secondary bg-opacity-90 text-white px-2 py-1 small rounded-top-end">
            Tú
          </div>
        </div>

        <!-- Video remoto -->
        <div class="w-100 h-100 min-vh-60 d-flex align-items-center justify-content-center">
          <video id="remoteVideo" autoplay class="w-100 h-100" style="max-height: 600px;"></video>
          <div id="waitingMessage" class="text-center text-white p-4 position-absolute top-50 start-50 translate-middle">
            <i class="bi bi-camera-video-off display-4 d-block mb-3 opacity-50"></i>
            <h3>Esperando conexión...</h3>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-xl-2 ms-auto">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-gradient-secondary text-white py-3">
        <h5 class="mb-0 fw-semibold">Chat de la sesión</h5>
      </div>
      <div class="card-body p-0 d-flex flex-column">
        <div id="chatMessages" class="flex-grow-1 p-3" style="height: 250px; overflow-y: auto;">
          <div class="text-center text-muted py-4">
            <i class="bi bi-chat-dots display-6 d-block mb-2 opacity-50"></i>
            <p class="small">El chat está listo para usar</p>
          </div>
        </div>

        <div class="border-top p-3 bg-light">
          <div class="input-group">
            <input type="text" id="chatInput" class="form-control form-control-sm" placeholder="Escribe un mensaje..." disabled>
            <button class="btn btn-primary btn-sm" id="btnSendMessage" disabled>
              <i class="bi bi-send-fill"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.bg-gradient-primary {
  background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%) !important;
}

.bg-gradient-secondary {
  background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%) !important;
}

.min-vh-60 {
  min-height: 60vh !important;
}

#chatMessages {
  scrollbar-width: thin;
  scrollbar-color: #cbd5e0 transparent;
}

#chatMessages::-webkit-scrollbar {
  width: 6px;
}

#chatMessages::-webkit-scrollbar-track {
  background: transparent;
}

#chatMessages::-webkit-scrollbar-thumb {
  background-color: #cbd5e0;
  border-radius: 3px;
}
</style>

</div>
    {% else %}
    NOOOOOOOOOOOOO

{% endif %}
{% endblock %}